!function(){"use strict";var app=angular.module("tirats",["ngRoute","ngCookies","toastr"]);app.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"landing/landing.html"}).when("/:operationId",{controller:"operationController as operationCtrl",templateUrl:"operation/operation.html"}).otherwise({redirectTo:"/"})}),app.config(function(toastrConfig){angular.extend(toastrConfig,{positionClass:"toast-top-full-width",maxOpened:1,target:".app-form",timeOut:1500})})}(),angular.module("tirats").run(["$templateCache",function($templateCache){$templateCache.put("landing/landing.html",'<ul style="margin-top:3em">\r\n    <li><a href="#/Addition?digit=1&max=9&min=0&level=A1">Addition - 1 digit</a></li>\r\n    <li><a href="#/Addition?digit=2&max=99&min=10&level=A2">Addition - 2 digit</a></li>\r\n    <li><a href="#/Addition?digit=3&max=999&min=100&level=A3">Addition - 3 digit</a></li>\r\n    <li><a href="#/Addition?digit=4&max=9999&min=1000&level=A4">Addition - 4 digit</a></li>\r\n    <li><a href="#/Addition?custom=true&max2=9&min2=0&max=19&min=0&level=AC">Addition - custom</a></li>\r\n    <li><a href="#/Subtraction?digit=1&max=9&min=0&level=S1">Subtraction - 1 digit</a></li>\r\n    <li><a href="#/Subtraction?digit=2&max=99&min=10&level=S2">Subtraction - 2 digit</a></li>\r\n    <li><a href="#/Subtraction?digit=3&max=999&min=100&level=S3">Subtraction - 3 digit</a></li>\r\n    <li><a href="#/Subtraction?digit=4&max=9999&min=1000&level=S4">Subtraction - 4 digit</a></li>\r\n    <li><a href="#/Subtraction?custom=true&max2=9&min2=0&max=19&min=10&level=SC">Subtraction - custom</a></li>\r\n    <li><a href="#/Multiplication?max=9&digit=1&level=M1">Multiplication - Number to 9 by 1 digit</a></li>\r\n    <li><a href="#/Multiplication?max=100&digit=1&level=M2">Multiplication - Numbers to 99 by 1 digit</a></li>\r\n    <li><a href="#/Multiplication?max=1000&digit=1&level=M3">Multiplication - Numbers to 999 by 1 digit</a></li>\r\n    <li><a href="#/Multiplication?max=10000&digit=1&level=M4">Multiplication - Numbers to 9999 by 1 digit</a></li>\r\n    <li><a href="#/Multiplication?max=100&digit=2&level=M5">Multiplication - Numbers to 99 by 2 digit</a></li>\r\n    <li><a href="#/Multiplication?max=1000&digit=2&level=M6">Multiplication - Numbers to 999 by 2 digit</a></li>\r\n    <li><a href="#/Multiplication?max=10000&digit=2&level=M7">Multiplication - Numbers to 9999 by 2 digit</a></li>\r\n</ul>'),$templateCache.put("operation/operation.html",'<div class="app-lesson-jumbotron">\r\n    <div class="app-jumbotron-content">\r\n        <div class="app-user-name"><a href="#/">{{::operationCtrl.page.userName}}</a></div>\r\n        <div class="app-lesson-title">{{::operationCtrl.page.title}}</div>\r\n    </div>\r\n</div>\r\n<div class="row">\r\n    <div class="app-score">\r\n        <span title="{{operationCtrl.page.title + \' - \' + operationCtrl.page.description}}">{{::operationCtrl.page.level}}</span>\r\n        {{::operationCtrl.page.scoreLabel}}: {{operationCtrl.userScore}}\r\n        <div>\r\n            <span>{{operationCtrl.page.timer.hours}}:</span><span>{{operationCtrl.page.timer.minutes}}:</span><span>{{operationCtrl.page.timer.seconds}}</span>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="row app-addition">\r\n    <div class="col-sm-6 app-operation">\r\n        <form class="app-form" name="calcForm" novalidate ng-submit="operationCtrl.checkAnswer()">\r\n            <div class="app-operand" ng-repeat="number in operationCtrl.operands">\r\n                <div ng-if="$index===operationCtrl.numberOfOperands -1">{{operationCtrl.page.operationSymbol}} {{number.value}}</div>\r\n                <div ng-if="$index!==operationCtrl.numberOfOperands -1">{{number.value}}</div>\r\n            </div>\r\n            <div class="app-answer-separator">________________</div>\r\n            <input type="text" class="app-input {{digit.position}}" size="1" maxlength="1" ng-model="digit.inputValue" required\r\n               ng-repeat="digit in operationCtrl.answer | orderBy:digit.position"\r\n               ng-change="operationCtrl.setElementFocusAfterInput(digit.position)"\r\n               ng-keyup="operationCtrl.markTimerAsNotIdle()" ng-pattern="/[0-9]/"/>\r\n            <input ng-disabled="calcForm.$invalid" type="submit" class="btn btn-primary app-submit">\r\n        </form>\r\n    </div>\r\n    <div class="col-sm-6">\r\n    </div>\r\n</div>\r\n<div ng-init="operationCtrl.setElementFocus(operationCtrl.answer.length-1)"></div>\r\n')}]),function(){"use strict";angular.module("tirats").factory("mathServices",[function(){var _maxNumber,_minNumber,_maxNumber2,_minNumber2,_operands=[],_setupPage=function(page){"Multiplication"!==page.operation?(page.title=page.custom?"Custom ":page.digit+"-Digit ",page.title+=page.operation,page.description="Numbers between "+page.min+" and "+page.max,_maxNumber=Number(page.max),_minNumber=Number(page.min),page.custom&&(_minNumber2=Number(page.min2),_maxNumber2=Number(page.max2))):(page.title=page.operation+" by "+page.digit+" digits",page.description="Numbers to "+page.max,_maxNumber=Number(page.max),"1"===page.digit?(_maxNumber2=9,_minNumber=0):"2"===page.digit?(_maxNumber2=99,_minNumber=10):"3"===page.digit?(_maxNumber2=999,_minNumber=100):"4"===page.digit&&(_maxNumber2=9999,_minNumber=1e3))},_randomIntFromInterval=function(min,max){return Math.floor(Math.random()*(max-min+1)+min)},_getOperands=function(page){var i,_numberOfOperands=2;if(_operands.length=0,_setupPage(page),"Addition"===page.operation&&page.custom)page.operationSymbol="+",_operands=[{value:_randomIntFromInterval(_minNumber,_maxNumber)},{value:_randomIntFromInterval(_minNumber2,_maxNumber2)}];else if("Addition"===page.operation)for(page.operationSymbol="+",_numberOfOperands=_randomIntFromInterval(2,3),i=0;i<_numberOfOperands;i++)_operands.push({value:_randomIntFromInterval(_minNumber,_maxNumber)});else if("Subtraction"===page.operation&&page.custom){page.operationSymbol="-",_operands=[{value:_randomIntFromInterval(_minNumber,_maxNumber)}];var max=_maxNumber2>_operands[0].value?_operands[0].value:_maxNumber2;_operands.push({value:_randomIntFromInterval(_minNumber2,max)})}else if("Subtraction"===page.operation)for(page.operationSymbol="-",i=0;i<_numberOfOperands;i++)i?_operands.push({value:_randomIntFromInterval(_minNumber,_operands[0].value)}):_operands.push({value:_randomIntFromInterval(_minNumber,_maxNumber)});else if("Multiplication"===page.operation)for(page.operationSymbol="X",i=0;i<_numberOfOperands;i++)i?_operands.push({value:_randomIntFromInterval(_minNumber,_maxNumber2)}):_operands.push({value:_randomIntFromInterval(_maxNumber2,_maxNumber)});return _operands},_getUserName=function(page){return page.userName="Tirat",page.userName};return{operands:_operands,getOperands:_getOperands,getUserName:_getUserName}}])}(),function(){"use strict";angular.module("tirats").controller("operationController",["mathServices","toastr","$cookies","$location","$routeParams","$interval","$scope",function(mathServices,toastr,$cookies,$location,$routeParams,$interval,$scope){var self=this,_previousGoodAnswer=!0,_setCookies=function(){$cookies.put(self.page.id+"Score",self.userScore),$cookies.put(self.page.id+"Correct",self.currentCorrect),$cookies.put(self.page.id+"Wrong",self.currentWrong),$cookies.put(self.page.id+"Time",self.page.timer.value)},_getCookies=function(){self.userScore=$cookies.get(self.page.id+"Score")||0,self.currentCorrect=$cookies.get(self.page.id+"Correct")||0,self.currentWrong=$cookies.get(self.page.id+"Wrong")||0};window.onbeforeunload=function(){$cookies.put(self.page.id+"Time",self.page.timer.value)},self.checkAnswer=function(){var goodAnswer=!0;angular.forEach(self.answer,function(digit){digit.inputValue!==digit.correctValue&&(goodAnswer=!1)}),goodAnswer?(toastr.success("You got it",self.answer),self.userScore++,self.currentCorrect++,_askQuestion()):(toastr.error("Not quite"),_previousGoodAnswer===!0&&self.userScore&&(self.userScore--,self.currentWrong++)),_previousGoodAnswer=goodAnswer,self.setElementFocus(self.answer.length-1),_setCookies()};var _getAnswer=function(operands){for(var _correctAnswer=operands[0].value,i=1;i<self.numberOfOperands;i++)"+"===self.page.operationSymbol?_correctAnswer+=self.operands[i].value:"-"===self.page.operationSymbol?_correctAnswer-=self.operands[i].value:"X"===self.page.operation&&(_correctAnswer*=self.operands[i].value);return _correctAnswer.toString()},_buildExpectedAnswer=function(){self.numberOfOperands=self.operands.length;var _i,_correctAnswerDigits=_getAnswer(self.operands).split(""),_numberOfExpectedDigits=_correctAnswerDigits.length,_zeroDigits=0;for(self.answer=[],"Subtraction"===self.page.operation&&(_zeroDigits=self.operands[0].value.toString().length-_numberOfExpectedDigits),_i=0;_i<_zeroDigits;_i++)self.answer.push({position:_i,correctValue:"0",inputValue:""});for(_i=0;_i<_numberOfExpectedDigits;_i++){var _answerDigit={position:_zeroDigits+_i,correctValue:_correctAnswerDigits[_i],inputValue:""};self.answer.push(_answerDigit)}};self.setElementFocus=function(position){window.setTimeout(function(){angular.element(".app-input."+position).focus(),angular.element(".app-input."+position).select()},100)},self.setElementFocusAfterInput=function(position){self.answer[position].inputValue&&self.setElementFocus(position-1)};var _askQuestion=function(){self.operands=mathServices.operands=mathServices.getOperands(self.page),_buildExpectedAnswer()},_setupTimer=function(){self.page.timer={isOn:!1,idleMark:90,stopper:void 0},self.page.timer.value=$cookies.get(self.page.id+"Time")||0,_setTimerDisplay()};self.startTimer=function(){self.page.timer.isOn||(self.page.timer.isOn=!0,self.page.timer.idle=0,self.page.timer.stopper=$interval(function(){self.page.timer.value++,self.page.timer.idle++,self.page.timer.idle>=self.page.timer.idleMark&&(_stopTimer(self.page.timer.stopper),self.page.timer.value-=self.page.timer.idleMark,self.page.timer.idle=0),_setTimerDisplay()},1e3))},self.markTimerAsNotIdle=function(){self.page.timer.idle=0};var _stopTimer=function(stopper){self.page.timer.isOn=!1,angular.isDefined(stopper)&&($interval.cancel(stopper),stopper=void 0)},_setTimerDisplay=function(){self.page.timer.hours=_addZeroToTheLeft(Math.floor(self.page.timer.value/3600)),self.page.timer.minutes=_addZeroToTheLeft(Math.floor(self.page.timer.value/60)),self.page.timer.seconds=_addZeroToTheLeft(Math.floor(self.page.timer.value%60))},_addZeroToTheLeft=function(value){return value<10&&(value="0"+value),value};!function(){self.page=$location.search(),self.page.operation=$routeParams.operationId,self.page.id=mathServices.getUserName(self.page)+self.page.operation+self.page.level,self.page.scoreLabel="Score",_setupTimer(),_getCookies(),_askQuestion(),self.startTimer(),$scope.$on("$destroy",function(){_stopTimer(self.page.timer.stopper)})}()}])}();